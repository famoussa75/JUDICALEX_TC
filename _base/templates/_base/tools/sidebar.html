{% load static %}


<style>
   .hover-effect:hover {
    background-color: darkblue; /* Couleur au survol */
    color: white;              /* Couleur du texte au survol */
    transform: scale(1.1);     /* Zoomer légèrement */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Ombre portée */
   }

   @keyframes shake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-3px); }
  40% { transform: translateX(3px); }
  60% { transform: translateX(-3px); }
  80% { transform: translateX(3px); }
  100% { transform: translateX(0); }
}

.shake {
  animation: shake 0.5s;
}
</style>

<aside class="sidebar" >
    <div class="sidebar__inner scrollable-content" >


       <!-- This element is only visible when sidebar Stick mode is active. -->
       <div class="sidebar__stuck align-items-center mb-3 px-3">
          <button type="button" class="sidebar-toggler btn-close btn-lg rounded-circle" aria-label="Close"></button>
          <p class="m-0 text-danger fw-bold">&lt;= Close the sidebar</p>
       </div>


       <!-- Sidebar tabs nav -->
       <div class="sidebar__wrap">
          <nav>
             <div class="nav nav-underline nav-fill nav-component flex-nowrap border-bottom" id="nav-tab" role="tablist">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#nav-chat" type="button" role="tab" aria-controls="nav-chat" aria-selected="true">
                   <i class="d-block demo-psi-bell fs-3 mb-2"></i>
                   <span>Notifications</span>
                </button>

                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-reports" type="button" role="tab" aria-controls="nav-reports" aria-selected="false">
                   <i class="d-block demo-pli-information fs-3 mb-2"></i>
                   <span>Synchronisation</span>
                </button>

             </div>
          </nav>
       </div>
       <!-- End - Sidebar tabs nav -->


       <!-- Sideabar tabs content -->
       <div class="tab-content sidebar__wrap" id="nav-tabContent">

          <!-- Chat tab Content -->
          <div id="nav-chat" class="tab-pane fade py-4 show active" role="tabpanel" aria-labelledby="nav-chat-tab">

             <!-- Family list group -->
             <div class="list-group list-group-borderless" id="notification-list" style="max-height: 300px; overflow-y: auto; overflow-x: hidden;">
             
            </div>
        
             <!-- End - Family list group -->

             <hr>

             <!-- Friends Group -->
             <h5 class="d-flex mt-5 px-3">Collaborateurs <span class="badge bg-success ms-auto">4</span></h5>
             <div class="list-group list-group-borderless">
               <div class="list-group-item list-group-item-action d-flex align-items-start mb-2">
                  <div class="flex-shrink-0 me-3">
                     <img class="img-xs rounded-circle" src="{% static '_base/assets/img/profile-photos/4.png' %}" alt="Profile Picture" loading="lazy">
                  </div>
                  <div class="flex-grow-1 ">
                     <a href="#" class="h6 d-block mb-0 stretched-link text-decoration-none"><span class="d-inline-block bg-success rounded-circle p-1 me-2"></span> George</a>
                     <small class="text-body-secondary">Connecté</small>
                  </div>
               </div>
               <div class="list-group-item list-group-item-action d-flex align-items-start mb-2">
                  <div class="flex-shrink-0 me-3">
                     <img class="img-xs rounded-circle" src="{% static '_base/assets/img/profile-photos/3.png' %}" alt="Profile Picture" loading="lazy">
                  </div>
                  <div class="flex-grow-1 ">
                     <a href="#" class="h6 d-block mb-0 stretched-link text-decoration-none"><span class="d-inline-block bg-danger rounded-circle p-1 me-2"></span> Oumar</a>
                     <small class="text-body-secondary">Déconnecté</small>
                  </div>
               </div>
               <div class="list-group-item list-group-item-action d-flex align-items-start mb-2">
                  <div class="flex-shrink-0 me-3">
                     <img class="img-xs rounded-circle" src="{% static '_base/assets/img/profile-photos/2.png' %}" alt="Profile Picture" loading="lazy">
                  </div>
                  <div class="flex-grow-1 ">
                     <a href="#" class="h6 d-block mb-0 stretched-link text-decoration-none"><span class="d-inline-block bg-danger rounded-circle p-1 me-2"></span> Aly</a>
                     <small class="text-body-secondary">Déconnecté</small>
                  </div>
               </div>
               <div class="list-group-item list-group-item-action d-flex align-items-start mb-2">
                  <div class="flex-shrink-0 me-3">
                     <img class="img-xs rounded-circle" src="{% static '_base/assets/img/profile-photos/1.png' %}" alt="Profile Picture" loading="lazy">
                  </div>
                  <div class="flex-grow-1 ">
                     <a href="#" class="h6 d-block mb-0 stretched-link text-decoration-none"><span class="d-inline-block bg-danger rounded-circle p-1 me-2"></span> Mariam</a>
                     <small class="text-body-secondary">Déconnecté</small>
                  </div>
               </div>
            
             </div>
             <!-- End - Friends Group -->

          </div>
          <!-- End - Chat tab content -->


          <!-- Reports tab content -->
          <div id="nav-reports" class="tab-pane fade py-4" role="tabpanel" aria-labelledby="nav-reports-tab">

             <!-- Billing and Resports -->
             <div class="px-3">
               <!-- Simple news widget -->
               <div class="p-3 mt-5 rounded bg-info-subtle text-info-emphasis">
                  <h5 class="text-info-emphasis">Important !</h5>
                  <p>La <b>synchronisation</b> vous permet de sauvegarder vos travaux sur un serveur en ligne et permettre en même temps aux personnes d'acceder facilement aux Rccms des entreprises à travers le site <a href="" class="link-info link-opacity-100">judicalex-gn.org</a>.</p>
               </div>
               <!-- End - Simple news widget -->
                <h5 class="mt-5 mb-0">Dernière synchronisation</h5>
                <p>Mardi 17 Décembre 2024 18:40</p>
                
               <div class="py-4 d-flex justify-content-center" >

                  <!-- Spinkit - Wave -->
                  <div class="sk-wave" id="loader-synchro" style="display: none;">
                     <div class="sk-wave-rect bg-warning"></div>
                     <div class="sk-wave-rect bg-warning"></div>
                     <div class="sk-wave-rect bg-warning"></div>
                     <div class="sk-wave-rect bg-warning"></div>
                     <div class="sk-wave-rect bg-warning"></div>
                  </div>
                  <!-- END : Spinkit - Wave -->

               </div>

               <p class="py-2 justify-content-center" id="loader-text" style="display: none; text-align: center;">Synchronisation encours . . .</p>

                <div class="d-grid">
                   <button class="btn btn-success" type="button" id="launch-sync"><i class="demo-pli-play-music"></i> Lancer la synchro . . .</button>
                   <button class="btn btn-danger" type="button" id="stop-sync" style="display: none;"> Arrêter la synchro . . .</button>
                </div>

             </div>
             <!-- End - Billing and Resports -->

          </div>
          <!-- End - Reports tab content -->

       </div>
       <!-- End - Sidebar tabs content -->

    </div>
 </aside>


 <script>

   document.getElementById('launch-sync').addEventListener('click', function () {
      launch_sync();
   });

   document.getElementById('stop-sync').addEventListener('click', function () {
      stop_sync();
   });

   function launch_sync() {
       // Afficher le loader
       document.getElementById('loader-synchro').style.display = 'flex';
       document.getElementById('loader-text').style.display = 'flex';

       document.getElementById('launch-sync').style.display = 'none';
       document.getElementById('stop-sync').style.display = 'flex';
   }

   function stop_sync() {
       // Afficher le loader
       document.getElementById('loader-synchro').style.display = 'none';
       document.getElementById('loader-text').style.display = 'none';

       document.getElementById('launch-sync').style.display = 'flex';
       document.getElementById('stop-sync').style.display = 'none';
   }
</script>

<script>

  function loadNotifications() {
    fetch('/account/notifications/json/')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('notification-list');
        container.innerHTML = ''; // Vider la liste

        if (data.notifications.length === 0) {
          container.innerHTML = '<div class="list-group-item text-center">Aucune notification !</div>';
          return;
        }

        data.notifications.forEach(notification => {
          const isRead = notification.is_read;
          const icon = isRead
            ? '<i class="demo-pli-bell fs-3" style="color: gray"></i>'
            : '<i class="demo-psi-bell fs-3 cloche" style="color:white"></i>';

          const statusText = isRead ? 'Lu' : 'Non lu';
          const statusClass = isRead ? 'text-body-secondary' : 'text-body-info';

          const html = `
            <div class="list-group-item list-group-item-action d-flex align-items-start mb-2 ">
              <div class="flex-shrink-0 me-3">${icon}</div>
              <div class="flex-grow-1">
                <a href="${notification.url}" class="h6 d-block mb-0 stretched-link text-decoration-none ${statusClass}" >
                  ${notification.message}
                </a>
                <small class="${statusClass}" >${statusText}</small>
              </div>
            </div>`;
          
          container.innerHTML += html;

          const cloches = document.querySelectorAll('.cloche');

         cloches.forEach(cloche => {
            cloche.classList.add('shake');
            setTimeout(() => {
               cloche.classList.remove('shake');
            }, 700); // même durée que dans l'animation CSS
         });

          
        });
      })
      .catch(error => {
        console.error('Erreur lors du chargement des notifications:', error);
      });
  }

  // Charger au démarrage
  document.addEventListener('DOMContentLoaded', () => {
    loadNotifications();
    setInterval(loadNotifications, 30000); // Recharge toutes les 30 secondes
  });


  

</script>
   